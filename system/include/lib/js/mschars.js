(function($){var chars = [{value:'mdash', title:'Длинное тире'},			 {value:'ndash', title:'Среднее тире'},			 {value:'laquo', title:'Левая кавычка'},			 {value:'raquo', title:'Правая кавычка'},			 {value:'trade', title:'Торговая марка'},			 {value:'reg', title:'Зарегистрированный товарный знак'},			 {value:'copy', title:'Авторское право'},			 {value:'euro', title:'Евро'},			 {value:'times', title:'Знак умножения'},			 {value:'deg', title:'Знак градуса'}],open = function() {	$('div.mschars').addClass('_closed');	this.parentNode.className = 'mschars'; },close = function(){$(this).parents('.mschars').addClass('_closed');},blur = function() {	if(typeof this.selectionStart == "number" && typeof this.selectionEnd == "number") this.__selection = {start : this.selectionStart, end : this.selectionEnd};	else	 {		var start = 0, end = 0, normalizedValue, range, textInputRange, len, endRange;		range = document.selection.createRange();		if(range && range.parentElement() == this)		 {			len = this.value.length;			normalizedValue = this.value.replace(/\r\n/g, "\n");			textInputRange = this.createTextRange();			textInputRange.moveToBookmark(range.getBookmark());			endRange = this.createTextRange();			endRange.collapse(false);			if(textInputRange.compareEndPoints("StartToEnd", endRange) > -1) start = end = len;			else			 {				start = -textInputRange.moveStart("character", -len);				start += normalizedValue.slice(0, start).split("\n").length - 1;				if(textInputRange.compareEndPoints("EndToEnd", endRange) > -1) end = len;				else				 {					end = -textInputRange.moveEnd("character", -len);					end += normalizedValue.slice(0, end).split("\n").length - 1;				 }			 }		 }		this.__selection = {start : start, end : end};	 } },select = function() {	var input = $(this).parents('.mschars').prev().get(0), start = 0, end = 0;	if(typeof(input.selectionStart) != 'undefined')	 {		start = input.selectionStart;		end = input.selectionEnd;	 }	if(document.selection && input.__selection)	 {		start = input.__selection.start;		end = input.__selection.end;	 }	input.value = input.value.substring(0, start) + this.innerHTML + input.value.substring(end);	close.call(this);	input.focus();	if(input.setSelectionRange) input.setSelectionRange(start + 1, start + 1);	else if(input.createTextRange)	 {		var r = input.createTextRange();		r.collapse(true);		r.moveEnd('character', start + 1);		r.moveStart('character', start + 1);		r.select();	 } },row_length = 10;$.fn.MSChars = function(){	if(this.length)	 {		var t = $('<table><tfoot><tr><td colspan="' + row_length + '"><input type="button" value="Закрыть" /></td></tr></tfoot><tbody></tbody></table>'), tb = t.find('tbody'), tr, i;		for(i = 0; i < chars.length; ++i)		 {			if(!(i % row_length)) tr = $('<tr />').appendTo(tb);			$('<td />').html('&' + chars[i].value + ';').prop('title', chars[i].title).click(select).appendTo(tr);		 }		if(i = i % row_length) for(i; i < row_length; ++i) $('<td />').addClass('empty').appendTo(tr);		t.find('tfoot input[type="button"]').click(close);		this.after($('<div />').addClass("mschars _closed").append($('<input type="button" value="Ω" title="Вставить специальный символ" />').click(open), t));		if(typeof(this.get(0).onbeforedeactivate) != 'undefined') this.each(function(){this.onbeforedeactivate = blur});	 }	return this;};})(jQuery);$(function(){$('input[type="text"].msui_input._mschars').MSChars();});